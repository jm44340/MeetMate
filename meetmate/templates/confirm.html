<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="refresh" content="{{qr_time}}">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link rel="stylesheet/less" type="text/css" href="../../static/css/styles.less" />
        <script src="../../static/js/less.js" type="text/javascript"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="../../static/js/qrcode.js"></script>
        <link rel="icon" href="../../static/resources/favicon.png" type="image/png" sizes="64x64">
    </head>
    <body>
        <div id="user-wrapper" class="content-wrapper container-md flex-column">
            <img id="icon" class="rounded mx-auto d-block" width="200" src="{{url_for('static', filename="/resources/svg/meeting.svg")}}">
            <h2 id="message" class="text-center text-white">Sprawdzanie lokalizacji...</h2>
        </div>
        <script>
            r = 0
            setTimeout(function(){
                navigator.geolocation.getCurrentPosition(function(position){
                    var form_data = new FormData()
                    form_data.append("latitude", position.coords.latitude);
                    form_data.append("longitude", position.coords.longitude);

                    var request = new XMLHttpRequest();
                    request.open("POST", document.location.href);
                    request.onreadystatechange = function(){
                        r = request
                        if(request.readyState !== XMLHttpRequest.DONE){
                            return;
                        }

                        if(request.status != 200){
                           ;
                        }

                        response = JSON.parse(request.responseText);
                        switch(response.status){
                            case "ERROR":
                                $('#icon').attr("src","{{url_for('static', filename="/resources/svg/close.svg")}}");
                                $('#message').text("Błąd.");
                                break;
                            case "TOO FAR":
                                $('#icon').attr("src","{{url_for('static', filename="/resources/svg/close.svg")}}");
                                $('#message').text("Jesteś za daleko.");
                                break;
                            case "OK":
                                $('#icon').attr("src","{{url_for('static', filename="/resources/svg/tick.svg")}}");
                                $('#message').text("Obecność potwierdzona!");
                                break;
                        }
                    };

                    request.send(form_data);
                })
            }, 1000);
            
        </script>
        <!-- <script src="../../static/js/qr_code_generation.js"></script> -->
    </body>
</html>